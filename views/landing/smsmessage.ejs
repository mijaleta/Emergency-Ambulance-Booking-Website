
  
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Emergency Ambulance</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Free HTML Templates" name="keywords">
    <meta content="Free HTML Templates" name="description">

    <!-- Favicon -->
    <link href="imgl/favicon.ico" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@400;700&family=Roboto:wght@400;700&display=swap"
        rel="stylesheet">

    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="libl/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="libl/tempusdominus/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet" />

    <!-- Customized Bootstrap Stylesheet -->
    <link href="cssl/bootstrap.min.css" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="cssl/style.css" rel="stylesheet">
    <title>Dispatched Detail and SMS</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/css/bootstrap.min.css">
  <link rel="stylesheet" href="../css/bootstrap.min.css" />
    <!-- site css -->
    <link rel="stylesheet" href="../style.css" />
    <!-- responsive css -->
    <link rel="stylesheet" href="../css/responsive.css" />
    <!-- color css -->
    <link rel="stylesheet" href="../css/colors.css" />
    <!-- select bootstrap -->
    <link rel="stylesheet" href="../css/bootstrap-select.css" />
    <!-- scrollbar css -->
    <link rel="stylesheet" href="../css/perfect-scrollbar.css" />
    <!-- custom css -->
    <link rel="stylesheet" href="../css/custom.css" />
    <link rel="stylesheet" href="../css/custom/register.css">
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
     <!-- site icon -->
   
          <style>
        body {
          background-color: #f8f9fa;
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
    
        .container {
          max-width: 500px;
          margin: 50px auto;
          padding: 20px;
          border-radius: 10px;
          box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
          background-color: #fff;
        }
    
        h2 {
          color: #007bff;
          text-align: center;
          margin-bottom: 30px;
        }
    
        .form-label {
          font-weight: bold;
        }
    
        .form-control {
          border-radius: 8px;
          border: 1px solid #ced4da;
        }
    
        .btn-primary {
          border-radius: 8px;
          padding: 10px 20px;
          font-weight: bold;
          background-color: #007bff;
          border: none;
          width: 100%;
        }
    
        .btn-primary:hover {
          background-color: #0056b3;
        }
    
        .modal-content {
          border-radius: 10px;
        }
      </style>
</head>


<body class="dashboard dashboard_1">
   <div class="full_container">
      <div class="inner_container">
         <!-- Sidebar  -->
         <nav id="sidebar">
            <div class="sidebar_blog_1">
               <div class="sidebar-header">
                  <div class="logo_section">
                     <a href="/"><img class="logo_icon img-responsive" src="../images/logo/logo_icon.png"
                           alt="#" /></a>
                  </div>
               </div>
               <div class="sidebar_user_info">
                  <div class="icon_setting"></div>
                  <div class="user_profle_side">
                     <div class="user_img"><img class="img-responsive" src="../images/layout_img/user.jpg" alt="#" />
                     </div>
                     <div class="user_info">
                        <h6>Dispatcher</h6>
                        <p><span class="online_animation"></span> Online</p>
                     </div>
                  </div>
               </div>
            </div>
            <div class="sidebar_blog_2">
               <h4>Ambulance Mgt</h4>
               <ul class="list-unstyled components">
                   <li class="active">
                     <a href="dispatcherDashboard" aria-expanded="false"><i class="fa fa-dashboard yellow_color"></i> <span>Dispatcher Dashboard</span></a>
                   </li>
                   <li><a href="schedule "><i class="fa fa-table purple_color2"></i>
                       <span>Schedule</span></a></li>
                   <li><a href="dispatcherAmbulance"><i class="fa fa-table purple_color2"></i>
                       <span>Ambulances</span></a></li>
                   <li><a href="patientRequest"><i class="fa fa-table purple_color2"></i> <span>Patient
                         Request</span></a></li>
       
                   <li><a href="dispatcherContact"><i class="fa fa-paper-plane red_color"></i>
                       <span>Contact</span></a></li>
                   <li><a href="dispatcherMap"><i class="fa fa-map purple_color2"></i> <span>Map</span></a></li>
                   <li><a href="dispatcherSettings"><i class="fa fa-cog yellow_color"></i>
                       <span>Settings</span></a></li>
                       <li><a href="ArchivedPatientRequest"><i class="fa fa-table purple_color2"></i> <span>Archived
                         Patient Request</span></a></li>
                         <li><a href="ArchivedAmbulance"><i class="fa fa-table purple_color2"></i> <span>Archived
                           Ambulance</span></a></li>
                 </ul>
           </div>
         </nav>
         <!-- end sidebar -->
         <!-- right content -->
         <div id="content">
            <!-- topbar -->
            <div class="topbar">
               <nav class="navbar navbar-expand-lg navbar-light">
                  <div class="full">
                     <button type="button" id="sidebarCollapse" class="sidebar_toggle"><i
                           class="fa fa-bars"></i></button>
                     <div class="logo_section">
                        <a href="/dispatcherDashboard"><img class="img-responsive" src="../images/logo/logo11.png" alt="#" /></a>
                     </div>
                     <div class="right_topbar">
                        <div class="icon_info">
                           <ul>
                              <li><a href="/patientRequest"><i id="bellIcon" class="fa fa-bell-o"></i><span id="notificationCount" class="badge">0</span></a></li>
                              <!-- <a href="#" id="bellIconLink"><i id="bellIcon" class="fa fa-bell-o"></i><span id="notificationCount" class="badge">0</span></a> -->

                              <li><a href="#"><i class="fa fa-question-circle"></i></a></li>
                              <li><a href="#"><i class="fa fa-envelope-o"></i><span class="badge">3</span></a></li>
                           </ul>
                           <ul class="user_profile_dd">
                              <li>
                                 <a class="dropdown-toggle" data-toggle="dropdown"><img
                                       class="img-responsive rounded-circle" src="../images/layout_img/user.jpg"
                                       alt="#" /><span class="name_user">Mr. X</span></a>
                                 <div class="dropdown-menu">
                                    <a class="dropdown-item" href="dispatcherDashboard">My Profile</a>
                                    <a class="dropdown-item" href="dispatcherSettings">Settings</a>
                                    <a class="dropdown-item" href="dispatcherDashboard">Help</a>
                                    <a class="dropdown-item" href="logout"><span>Log Out</span> <i
                                          class="fa fa-sign-out"></i></a>
                                 </div>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div>
               </nav>
            </div>
            
  <div class="container">
    <form id="smsForm" action="/send-sms" method="post">
      <h2>Realtime SMS Details</h2>
      <div class="form-group">
        <label for="recipients" class="form-label">Recipients</label>
        <input type="text" class="form-control" id="recipients" name="recipients" placeholder="Enter recipient numbers separated by commas" value="<%= mobile_number %>,<%= nmobile_number %>, <%= oldestHighRequest.contactInfo %>" required>
      </div>
      <div class="form-group">
        <label for="messageText" class="form-label">Message</label>
        <textarea class="form-control" id="messageText" name="messageText" rows="5" placeholder="Enter your message"></textarea>
      </div>
      <button type="submit" class="btn btn-send btn-block" id="sendSMS">Send SMS</button>
    </form>
  </div>

  <!-- Modal -->
 <div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="successModalLabel">Congratulations</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                Message sent successfully!
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">OK</button>
                            </div>
                        </div>
                    </div>
                </div>


  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var form = document.getElementById('smsForm');
      var recipientsInput = document.getElementById('recipients');
      var messageText = document.getElementById('messageText');

      // Generate the messages based on booking request details
      var messageForFirstTwo = `<% if (oldestHighRequest) { %>
    Contact Info: <%= oldestHighRequest.contactInfo %>
    Address: <%= oldestHighRequest.address %>
    Patient Condition: <%= oldestHighRequest.patient_condition %>
    Emergency Type: <%= oldestHighRequest.emergency_type %>
  <% } else { %>
    No booking requests found.
  <% } %>`.replace(/\s+/g, ' ').trim();

      var messageForThird = "Ambulance is dispatched successfully and wait until it reach you.";

      // Set initial value for the message text area
      messageText.value = `${messageForFirstTwo}, ${messageForThird}`;

       form.addEventListener('submit', function(event) {
        event.preventDefault();

        var recipients = recipientsInput.value.split(',').map(function(recipient) {
          return recipient.trim();
        });

        if (recipients.length !== 3) {
          alert("Please enter exactly three recipient numbers.");
          return false;
        }

        var messages = messageText.value.split(',');
        if (messages.length !== 2) {
          alert("The message textarea should contain exactly two messages separated by a comma.");
          return false;
        }

        var messageForFirstTwo = messages[0].trim();
        var messageForThird = messages[1].trim();

        // Prepare the messages for each recipient
        var recipientMessages = [
          { number: recipients[0], message: messageForFirstTwo },
          { number: recipients[1], message: messageForFirstTwo },
          { number: recipients[2], message: messageForThird }
        ];

        // Simulate sending the SMS
        var promises = recipientMessages.map(function(recipient) {
          console.log(`Sending message to ${recipient.number}: ${recipient.message}`);
          // Simulate an API call
          return fetch('/send-sms', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              recipients: recipient.number,
              messageText: recipient.message
            })
          })
          .then(response => response.json())
          .then(data => {
            if (data.status === 200) {
              console.log(`SMS sent successfully to ${recipient.number}`);
            } else {
              console.error(`Error sending SMS to ${recipient.number}: ${data.message}`);
            }
          })
          .catch(error => {
            console.error(`Network error sending SMS to ${recipient.number}:`, error);
          });
        });

       Promise.all(promises).then(() => {
                                // Show the modal
                                var successModal = new bootstrap.Modal(document.getElementById('successModal'));
                                successModal.show();

                                // Hide the modal and redirect after 3 seconds
                                setTimeout(function () {
                                    successModal.hide();
                                    window.location.href = '/patientRequest';
                                }, 4000);
                            });

    
        return false;
      });
    });

  </script>
    <script src="../js/jquery.min.js"></script>
    <script src="../js/popper.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <!-- wow animation -->
    <script src="../js/animate.js"></script>
    <!-- select country -->
    <script src="../js/bootstrap-select.js"></script>
    <!-- owl carousel -->
    <script src="../js/owl.carousel.js"></script> 
    <!-- chart js -->
    <script src="../js/Chart.min.js"></script>
    <script src="../js/Chart.bundle.min.js"></script>
    <script src="../js/utils.js"></script>
    <script src="../js/analyser.js"></script>
    <!-- nice scrollbar -->
    <script src="../js/perfect-scrollbar.min.js"></script>
    <script>
        var ps = new PerfectScrollbar('#sidebar');
    </script>
    <!-- custom js -->
    <script src="../js/chart_custom_style1.js"></script>
    <script src="../js/custom.js"></script>

  <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
</body>
</html>
